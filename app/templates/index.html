{% extends 'base.html' %}


{% block app_content %}
    <div class="d-flex justify-content-between">
        <div class="d-flex">
            <a href="{{ url_for('main.index', month=month-1, year=year) }}"><h2>❮</h2></a>
            <h2>{{ date[0] }} {{ date[1] }}</h2>
            <a href="{{ url_for('main.index', month=month+1, year=year) }}"><h2>❯</h2></a>
        </div>
        <a href="{{ url_for('card.create') }}"><button class="light-button">Add card</button></a>
    </div>
    <div class="d-flex my-2">
        <div class="flex-column">
            <a href="{{ prev_url }}">
                <button class="paginate-button" type="button" {% if prev_url is none %}disabled{% endif %}>
                    ❮
                </button>
            </a>
        </div>
        <div class="flex-column flex-grow-1">
            <table class="table my-0" style="background-color: #ffffff">
                {% for card in cards.items %}
                    {% include '_card.html' %}
                {% endfor %}
                <td><span class="index-card__total">Total</span></td>
                {% if total < 0 %}
                    <td><span class="index-card__total f-right" style="color: #eb0000;">{{ total }} {{ currency }} </span></td>
                {% else %}
                    <td><span class="index-card__total f-right" style="color: #00af00;">+{{ total }} {{ currency }}</span></td>
                {% endif %}
            </table>
        </div>
        <div class="flex-column">
            <a href="{{ next_url }}">
                <button class="paginate-button" type="button" {% if next_url is none %}disabled{% endif %}>
                    ❯
                </button>
            </a>
        </div>
    </div>
    <div class="d-flex flex-row justify-content-between">
        <div class="d-flex flex-column" style="background-color: #ffffff">
            <span class="p-2" style="border-bottom: 1px solid #efefef">Top-5 expensive categories</span>
            <table class="table my-0" style="width: 550px; ">
            {% for percent in percents %}
                <tr>
                    <td class="percent"><span>{{ percent[0] }}</span></td>
                    <td class="percent"><span>{{ percent[1] }}</span></td>
                </tr>
            {% endfor %}
            </table>
        </div>
        <div class="d-flex flex-column" style="background-color: #ffffff">
            <span class="p-2" style="border-bottom: 2px solid #efefef">Costs per {{ date[1] }}</span>
            <div class="" style="width: 550px;">
                <canvas id="pieAllCategories"></canvas>
            </div>
        </div>
    </div>
{% endblock %}


{% block scripts %}
    <script>
        let categories = {{ categories|safe }};
        let prices = {{ prices|safe }}
        new Chart(document.getElementById("pieAllCategories").getContext('2d'), {
            type: 'pie',
            data: {
                labels: categories,
                datasets: [{
                    backgroundColor: {{ bg_colors|safe }},
                    data: prices,
                }]
            },
            options: {
                legend: {
                    display: true,
                    position: 'left'
                }
            }
        });
        $.ajax();
    </script>
{% endblock %}